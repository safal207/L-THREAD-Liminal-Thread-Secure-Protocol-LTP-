version: '3.8'

services:
  # LTP Server (JavaScript)
  ltp-server-js:
    build:
      context: ./examples/js-minimal-server
      dockerfile: Dockerfile
    ports:
      - "127.0.0.1:8080:8080"
    environment:
      - PORT=8080
    networks:
      - ltp-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 10s
      timeout: 5s
      retries: 3

  # LTP Server (Elixir)
  ltp-server-elixir:
    build:
      context: ./examples/elixir-server
      dockerfile: Dockerfile
    ports:
      - "127.0.0.1:8081:8080"
    environment:
      - PORT=8080
    networks:
      - ltp-network
    depends_on:
      - ltp-server-js

  # LTP Server (Rust)
  ltp-server-rust:
    build:
      context: ./nodes/ltp-rust-node
      dockerfile: Dockerfile
    ports:
      - "127.0.0.1:7070:7070"
    environment:
      - LTP_NODE_ADDR=0.0.0.0:7070
      - TRUST_PROXY=false
    networks:
      - ltp-network

networks:
  ltp-network:
    driver: bridge

# Usage:
# docker-compose up -d                    # Start all servers
# docker-compose up ltp-server-js         # Start only JS server
# docker-compose logs -f ltp-server-js    # View logs
# docker-compose down                     # Stop all servers
