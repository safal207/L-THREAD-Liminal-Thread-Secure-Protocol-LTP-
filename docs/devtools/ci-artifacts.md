# CI Artifacts: Inspector Outputs & Golden Traces

This repo publishes reproducible DevTools artifacts on every CI run.
They are intended for platform teams to validate **orientation continuity**
without rerunning models or rehydrating ad-hoc context.

One-click reproducibility = CI publishes the exact traces and inspector outputs needed to reproduce locally without model execution.

## Quick verification flow

1. Open the CI run → download inspector + golden trace artifacts
2. Compare inspector output to golden trace (schema + transitions)
3. Reproduce locally using the same trace
4. If golden changes — it is a protocol change, not an accident

## What CI produces

Each CI run uploads artifacts that you can download from the GitHub Actions UI:

- **Inspector output** (`inspect-output.txt` or `.json`)
  - A canonical, deterministic view of:
    - orientation frames
    - drift / constraints
    - admissible futures (if present in trace)
- **Golden traces**
  - Known-good traces used as fixtures for conformance / inspector stability
  - Useful for regression checks and debugging

> These artifacts are "control-plane" signals.
> They describe **coherence over time**, not model quality.

## CI Artifacts: Canonical Set & Location

Minimum set to download from a CI run:

- `canonical-inspector-output/inspect-output.json` (or `.txt`)
- `golden-traces/golden-trace.json` (if present in the run)
- `conformance-report.json` (if generated by the conformance job)

Where to find them in GitHub Actions:

- GitHub Actions run → **Artifacts** section
- Job name: Inspector / Conformance
- Bundle name: `ltp-ci-artifacts` (or equivalent)

---

## How to retrieve CI artifacts

1. Open the GitHub Actions run for the commit.
2. Navigate to the "Artifacts" section.
3. Download the artifact bundle (e.g. `ltp-ci-artifacts.zip`).
4. Extract locally.
5. Inspect artifacts using LTP DevTools.

---

## How to read Inspector output

Inspector output is meant to be stable and CI-friendly.
Typical fields you should expect to see:

- `identity` — stable continuity handle (not user identity)
- `focus_momentum` — continuity weight over time (control-plane)
- `drift_history` — tracked deviation signals
- `constraints` — policy/resources/safety gates
- `admissible_futures` — future branches that remain coherent

If the output changes unexpectedly between PRs, it usually means:
- a schema/format regression
- a fixture was modified
- an inspector rule changed (should be versioned)

---

## Local reproduction

To reproduce CI artifacts locally:

### 1) Install workspace deps
```bash
pnpm -w install
```

### 2) Run inspector on canonical fixture
```bash
pnpm -w ltp:inspect -- trace \
  --strict \
  --input tools/ltp-inspect/fixtures/canonical-clean.jsonl \
  --format=json
```

### 3) Validate a conformance report (if generated)
```bash
pnpm -w ltp:report:validate -- artifacts/conformance-report.json
```

---

## What CI artifacts are not

- Not a recommendation output
- Not model evaluation
- Not a memory store dump
- Not orchestration logs

CI artifacts exist to answer one question:

> Did the system preserve a coherent orientation trajectory across changes, retries, and tooling updates?

---

## Common failure modes

### 1. Missing artifacts
**Symptom:**  
Expected CI artifacts are not available in the workflow run.

**Likely cause:**  
Artifact upload step failed or was skipped.

**Next check:**  
Verify `actions/upload-artifact` step in the workflow.

---

### 2. Non-deterministic output
**Symptom:**  
Inspector output differs between identical runs.

**Likely cause:**  
Unstable ordering or non-deterministic branch evaluation.

**Next check:**  
Ensure deterministic sorting and fixed seeds in test data.

---

### 3. Schema drift
**Symptom:**  
Inspector fails to parse artifact files.

**Likely cause:**  
Artifact schema version mismatch.

**Next check:**  
Confirm artifact schema matches the inspector version.

---

## Example artifact output

```json
{
  "orientation_id": "8f3c…",
  "focus_momentum": 0.71,
  "drift": "aligned",
  "admissible_futures": [
    { "id": "A", "confidence": 0.62 },
    { "id": "B", "confidence": 0.24 }
  ]
}
```

This output represents orientation state at a specific transition point. It can be replayed and compared without running a model.

---

## Suggested workflow for reviewers

When reviewing DevTools changes:

1. Download canonical-inspector-output
2. Compare to previous PR output
3. Confirm changes are:
   - intentional
   - documented
   - compatible (or versioned)

This keeps DevTools stable while SDK/tooling can iterate quickly.

## Source of truth

- Golden traces are the canonical source of truth for protocol behavior.
- Inspector output is a projection for observability and debugging.
- Inspector may evolve; golden traces define correctness.

## Reviewer checklist

- [ ] Does inspector output match golden trace?
- [ ] If golden changed — is this an intentional protocol change?
- [ ] Can the behavior be reproduced locally?
